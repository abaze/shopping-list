(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{242:function(t,e,r){var content=r(406);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(31).default)("bd570722",content,!0,{sourceMap:!1})},405:function(t,e,r){"use strict";var n=r(242);r.n(n).a},406:function(t,e,r){(e=r(30)(!1)).push([t.i,".progress-bar[data-v-dd3d2098]{overflow:visible;overflow:initial}",""]),t.exports=e},421:function(t,e,r){"use strict";r.r(e);var n=r(0),o=(r(83),r(84),r(39),r(10)),c={middleware:"auth",data:function(){return{ready_product_line:!0,categories:null,user:{jwt:null},form:{dateCourse:null,budget_max:null},panier:[],animatedTTC:0,animatedRestant:0,show_save_overlay:!1,show_recap:!1,id_recap:null,datesListes:[]}},head:function(){return{title:"Composez votre liste de course tout en surveillant votre budget",script:[{src:"https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"}]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params,n=t.$axios,e.next=3,n.$get("/listes/"+r.id);case 3:return data=e.sent,e.abrupt("return",{form:{dateCourse:data.date||null,budget_max:data.budget||null},panier_recovered:data.produits||null,id_liste:r.id});case 5:case"end":return e.stop()}}),e)})))()},computed:{state_date:function(){return this.form.dateCourse?!this.datesListes.includes(this.form.dateCourse):null},total_facture_ht:function(){if(this.panier.length>0){var t=0;return this.panier.forEach((function(e){e.produits.forEach((function(p){t+=parseFloat(p.price*parseInt(p.quantity))}))})),t}return 0},total_facture_ttc:function(){if(this.total_facture_ht)return this.total_facture_ht>0?parseFloat(1.196*this.total_facture_ht).toFixed(2):0},count_produits:function(){if(this.panier.length>0){var t=0;return this.panier.forEach((function(e){e.produits.forEach((function(p){t+=parseInt(p.quantity)}))})),t}return 0},total_restant_depense:function(){if(this.form.budget_max&&this.total_facture_ttc)return parseFloat(this.form.budget_max-this.total_facture_ttc).toFixed(2)},status_color:function(){var t=parseInt(this.form.budget_max/2);return this.total_restant_depense>=t?"success":this.total_restant_depense<=0?"danger":"warning"}},watch:{total_facture_ttc:function(t){this.animateNumber({val:t,targetVar:"animatedTTC"})},total_restant_depense:function(t){this.animateNumber({val:t,targetVar:"animatedRestant"})}},methods:{dateDisabled:function(t,e){return e<new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate())},getDatesListes:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.get("/listes").then((function(t){return t.data})).then((function(t){return t.map((function(t){return t.date}))}));case 2:t.datesListes=e.sent;case 3:case"end":return e.stop()}}),e)})))()},listExist:function(t,e){return this.datesListes.includes(t)?"bg-warning disable":""},maj_product:function(t){0==this.panier.length||0==this.panier.filter((function(e){return e.id_cat==t.id_cat})).length?this.panier.push(t):this.panier.forEach((function(e){e.id_cat==t.id_cat&&(e=t)}))},saveListe:function(){var t=this,e=this;this.show_save_overlay=!0,this.$axios.put("/listes/"+this.id_liste,{date:this.form.dateCourse,budget:this.form.budget_max,prix:this.total_facture_ttc,produits:this.panier,count_produits:this.count_produits},{headers:{Authorization:"Bearer ".concat(this.user.jwt)}}).then((function(r){t.form.dateCourse=null,t.panier=[],t.ready_product_line=!1,t.id_recap=r.data.id,setTimeout((function(){e.show_save_overlay=!1,e.show_recap=!0}),3e3)}))},animateNumber:function(t){var e=t.val,r=t.duration,o=void 0===r?.5:r,c=t.targetVar;gsap&&gsap.to(this.$data,Object(n.a)({duration:o},c,e))}},fetch:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.store,t.params,e.next=3,r.dispatch("GET_CATEGORIES");case 3:case"end":return e.stop()}}),e)})))()},mounted:function(){this.categories=this.$store.state.categories,this.user.jwt=this.$store.state.user.jwt,this.ready_product_line=!0,this.getDatesListes()}},d=(r(405),r(24)),component=Object(d.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.show_recap?r("div",[r("b-row",[r("b-col",[r("span",{staticClass:"h3"},[t._v("Votre liste a été modifiée avec succès !")]),t._v(" "),r("hr")])],1),t._v(" "),r("recap-liste",{attrs:{id:t.id_recap}})],1):r("b-overlay",{attrs:{show:t.show_save_overlay}},[r("h1",[t._v("Modifiez votre liste de course")]),t._v(" "),r("b-form",[r("b-form-group",{staticClass:"animate__animated animate__fadeInRight position-relative",staticStyle:{"z-index":"1"},attrs:{label:"Date de vos course"}},[r("b-form-datepicker",{staticClass:"mb-2 w-25 min-w-300",attrs:{disabled:""},model:{value:t.form.dateCourse,callback:function(e){t.$set(t.form,"dateCourse",e)},expression:"form.dateCourse"}})],1),t._v(" "),r("b-form-group",{staticClass:"animate__animated animate__fadeInRight",attrs:{label:"Votre limite de budget ?"}},[r("b-row",[r("b-col",{attrs:{sm:"6"}},[r("b-input-group",{staticClass:"w-25 min-w-300",attrs:{size:"lg",append:"€"}},[r("b-form-input",{attrs:{disabled:""},model:{value:t.form.budget_max,callback:function(e){t.$set(t.form,"budget_max",e)},expression:"form.budget_max"}})],1)],1),t._v(" "),r("b-col",{staticClass:"h1 animate__animated animate__zoomIn min-w-300 text-right",class:"text-"+t.status_color},[t._v("\n            Total TTC :\n            "),r("strong",[t._v(t._s(parseFloat(t.animatedTTC).toFixed(2))+" €")])])],1),t._v(" "),r("b-progress",{staticClass:"animate__animated animate__fadeInLeft mt-2",attrs:{max:t.form.budget_max,height:"2rem",variant:t.status_color}},[r("b-progress-bar",{attrs:{value:t.total_restant_depense<0?0:t.total_restant_depense,striped:"",animated:""}},[r("span",["success"==t.status_color?r("strong",[r("b-iconstack",{staticClass:"align-middle mr-1",attrs:{"font-scale":"1.5"}},[r("b-icon",{attrs:{stacked:"",icon:"circle"}}),t._v(" "),r("b-icon",{attrs:{stacked:"",icon:"check"}})],1),t._v("\n                Reste "+t._s(parseFloat(t.animatedRestant).toFixed(2))+" € à\n                dépenser\n              ")],1):"warning"==t.status_color?r("strong",[r("b-icon",{staticClass:"align-middle mr-1",attrs:{icon:"exclamation-circle","font-scale":"1.5"}}),t._v("\n                Reste "+t._s(parseFloat(t.animatedRestant).toFixed(2))+" € à\n                dépenser\n              ")],1):r("strong",{staticClass:"text-danger"},[r("b-icon",{staticClass:"align-middle mr-1",attrs:{icon:"exclamation-triangle-fill",animation:"throb","font-scale":"1.5"}}),t._v("\n                Vous dépassez votre budget de\n                "+t._s(parseFloat(t.animatedRestant).toFixed(2))+" €\n              ")],1)])])],1)],1),t._v(" "),t.form.budget_max?r("b-form-group",{attrs:{label:"De quoi avez-vous besoin ?",description:"Remplissez chaque catégorie des produits dont vous avez besoin"}},[r("b-form-row",t._l(t.categories,(function(e,n){return r("b-col",{key:e.id,attrs:{cols:"12",xl:"6"}},[t.ready_product_line?r("add-products",{key:e.name,class:"animate__animated animate__bounceInRight animate__delay-"+n+"s",attrs:{categorie_id:e.id,recovered_data:t.panier_recovered},on:{majProduct:t.maj_product}}):t._e()],1)})),1)],1):t._e(),t._v(" "),t.total_facture_ttc>0?r("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-save",modifiers:{"modal-save":!0}}],staticClass:"w-100 animate__animated animate__fadeInRight",attrs:{size:"lg",variant:"color-primary"}},[t._v("Enregistrer les modifications")]):t._e(),t._v(" "),r("b-modal",{attrs:{id:"modal-save",title:"Confirmation"},on:{ok:t.saveListe}},[r("p",{staticClass:"my-4"},[t._v("Êtes-vous sûr de n'avoir rien oublié ?")])])],1)],1)],1)}),[],!1,null,"dd3d2098",null);e.default=component.exports;installComponents(component,{AddProducts:r(386).default,RecapListe:r(233).default})}}]);